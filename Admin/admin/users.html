<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Dashboard - Users</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    body { font-family: sans-serif; }
  </style>
</head>
<body class="bg-gray-50">

  <!-- Header -->
  <header class="bg-white shadow-sm border-b">
    <div class="max-w-7xl mx-auto px-4 flex justify-between items-center py-4">
      <h1 class="text-2xl font-bold text-gray-900">Gift Cards Admin Dashboard</h1>
      <div class="flex items-center space-x-4">
        <div class="relative">
          <i data-lucide="bell" class="w-6 h-6 text-gray-600 cursor-pointer" id="notif-icon"></i>
          <span id="notif-count" class="hidden absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">0</span>
        </div>
        <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center text-white font-semibold"><a href="form.html">C</a></div>
        <div><a href="allcards.html">Requests</a></div>
        <button id="logoutButton" class="btn-logout">Logout</button>
        <div><a href="crypto.html">Crypto</a></div>
      </div>
    </div>
  </header>

  <!-- Users Content -->
  <main class="max-w-7xl mx-auto px-4 py-8" id="users-content"></main>

  <script>
    // Protect route
    const adminToken = localStorage.getItem('adminToken');
    if (!adminToken) {
      window.location.href = 'https://cardzip-admin.netlify.app/signin.html';
    }

    lucide.createIcons();

    const usersContent = document.getElementById('users-content');
    let users = [];

    const API_USERS = 'https://trader-sr5j-0k7o.onrender.com/api/users/get';

    // Fetch users
    async function loadUsers() {
      try {
        const res = await fetch(API_USERS);
        if (!res.ok) throw new Error(`Server returned ${res.status}`);
        const data = await res.json();

        users = data.map(u => ({
          name:          u.name,
          email:         u.email,
          accountNumber: u.accountNumber || '—',
          accountName:   u.accountName   || '—',
          bankName:      u.bankName      || '—',
          status:        u.status        || 'active'
        }));

        renderUsers();
      } catch (err) {
        console.error('Could not load users:', err);
        usersContent.innerHTML = `<p class="text-red-500">Failed to load users.</p>`;
      }
    }

    function renderUsers() {
      usersContent.innerHTML = `
        <div class="bg-white rounded-lg shadow-md p-6">
          <h2 class="text-lg font-semibold text-gray-900 mb-4">Users</h2>
          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
              <thead class="bg-gray-50">
                <tr>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Name</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Email</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Account #</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Account Name</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Bank</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                </tr>
              </thead>
              <tbody class="bg-white divide-y divide-gray-200">
                ${users.map(u => `
                  <tr class="hover:bg-gray-50">
                    <td class="px-6 py-4 text-sm text-gray-900">${u.name}</td>
                    <td class="px-6 py-4 text-sm text-gray-500">${u.email}</td>
                    <td class="px-6 py-4 text-sm text-gray-900">${u.accountNumber}</td>
                    <td class="px-6 py-4 text-sm text-gray-900">${u.accountName}</td>
                    <td class="px-6 py-4 text-sm text-gray-900">${u.bankName}</td>
                    <td class="px-6 py-4 text-sm">
                      <span class="px-2 py-1 text-xs rounded-full ${
                        u.status === 'premium'
                          ? 'bg-purple-100 text-purple-800'
                          : 'bg-green-100 text-green-800'
                      }">${u.status}</span>
                    </td>
                  </tr>`).join('')}
              </tbody>
            </table>
          </div>
        </div>`;
    }

    loadUsers();

    // Refresh every 10s
    setInterval(loadUsers, 10000);

  </script>
</body>
</html>
